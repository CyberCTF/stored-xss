<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tableau de Bord Admin - Cabinet Martin & Associés</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        dark: {
                            50: '#f8fafc',
                            100: '#f1f5f9',
                            200: '#e2e8f0',
                            300: '#cbd5e1',
                            400: '#94a3b8',
                            500: '#64748b',
                            600: '#475569',
                            700: '#334155',
                            800: '#1e293b',
                            900: '#0f172a',
                            950: '#020617'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        }
        .glass {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(148, 163, 184, 0.2);
        }
    </style>
</head>
<body class="bg-dark-900 text-gray-100 min-h-screen">
    <!-- Navigation -->
    <nav class="glass border-b border-gray-700 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <h1 class="text-2xl font-bold text-blue-400">Martin & Associés</h1>
                    <span class="ml-4 text-sm text-gray-400">Administration</span>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="/internal-data" class="text-blue-400 hover:text-blue-300 px-3 py-2 rounded-md text-sm font-medium">
                        Données Internes
                    </a>
                    <button onclick="logout()" class="text-gray-300 hover:text-red-400 px-3 py-2 rounded-md text-sm font-medium">
                        Déconnexion
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="py-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="mb-8">
                <h1 class="text-3xl font-bold text-gray-100 mb-2">Tableau de Bord</h1>
                <p class="text-gray-300">Gestion des messages clients</p>
            </div>

            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="glass rounded-lg p-6">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <svg class="h-8 w-8 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                            </svg>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-300">Messages Totaux</p>
                            <p id="totalMessages" class="text-2xl font-bold text-gray-100">0</p>
                        </div>
                    </div>
                </div>

                <div class="glass rounded-lg p-6">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <svg class="h-8 w-8 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-300">Aujourd'hui</p>
                            <p id="todayMessages" class="text-2xl font-bold text-gray-100">0</p>
                        </div>
                    </div>
                </div>

                <div class="glass rounded-lg p-6">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <svg class="h-8 w-8 text-yellow-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5v-5zM4 19h6v-2H4v2zM4 15h6v-2H4v2zM4 11h6V9H4v2zM4 7h6V5H4v2zM10 7h10V5H10v2zM10 11h10V9H10v2zM10 15h10v-2H10v2zM10 19h10v-2H10v2z" />
                            </svg>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-300">En Attente</p>
                            <p id="pendingMessages" class="text-2xl font-bold text-gray-100">0</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Messages List -->
            <div class="glass rounded-lg">
                <div class="px-6 py-4 border-b border-gray-700">
                    <h2 class="text-xl font-semibold text-gray-100">Messages Clients</h2>
                </div>
                
                <div class="p-6">
                    <div id="messagesContainer" class="space-y-6">
                        <div class="text-center text-gray-400 py-8">
                            <svg class="mx-auto h-12 w-12 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4" />
                            </svg>
                            <p class="mt-2">Aucun message pour le moment</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Load messages on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadMessages();
        });

        async function loadMessages() {
            try {
                const response = await fetch('/api/messages');
                if (!response.ok) {
                    if (response.status === 401) {
                        window.location.href = '/admin';
                        return;
                    }
                    throw new Error('Erreur lors du chargement des messages');
                }

                const messages = await response.json();
                displayMessages(messages);
                updateStats(messages);
            } catch (error) {
                console.error('Erreur:', error);
                document.getElementById('messagesContainer').innerHTML = `
                    <div class="text-center text-red-400 py-8">
                        <p>Erreur lors du chargement des messages</p>
                    </div>
                `;
            }
        }

        function displayMessages(messages) {
            const container = document.getElementById('messagesContainer');
            
            // Messages fictifs pour un aspect plus réaliste
            const fakeMessages = [
                {
                    subject: "Consultation - Divorce",
                    name: "Marie Dubois",
                    email: "marie.dubois@email.com",
                    created_at: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString(),
                    message: "Bonjour, je souhaite prendre rendez-vous pour une consultation concernant mon divorce. Mon mari et moi avons des biens immobiliers à partager et je voudrais connaître mes droits. Pouvez-vous me contacter pour fixer un rendez-vous ?"
                },
                {
                    subject: "Question - Contrat de travail",
                    name: "Thomas Martin",
                    email: "thomas.martin@entreprise.fr",
                    created_at: new Date(Date.now() - 4 * 60 * 60 * 1000).toISOString(),
                    message: "Mon employeur veut modifier mon contrat de travail sans mon accord. Il parle de réorganisation mais je ne suis pas d'accord avec les nouvelles conditions. Quels sont mes recours ?"
                },
                {
                    subject: "Succession - Testament",
                    name: "Sophie Leroy",
                    email: "sophie.leroy@yahoo.fr",
                    created_at: new Date(Date.now() - 6 * 60 * 60 * 1000).toISOString(),
                    message: "Mon père est décédé il y a 3 mois et nous avons trouvé un testament. Ma sœur conteste la validité du document. J'ai besoin d'aide pour comprendre la situation et protéger mes intérêts."
                },
                {
                    subject: "Litige commercial",
                    name: "Pierre Moreau",
                    email: "pierre.moreau@startup.com",
                    created_at: new Date(Date.now() - 8 * 60 * 60 * 1000).toISOString(),
                    message: "Notre entreprise a un litige avec un fournisseur qui ne respecte pas les délais de livraison. Nous avons perdu des clients à cause de ces retards. Nous voulons engager une procédure."
                }
            ];

            // Afficher les messages fictifs si aucun vrai message
            const messagesToDisplay = messages.length > 0 ? messages : fakeMessages;

            container.innerHTML = messagesToDisplay.map(message => `
                <div class="glass rounded-lg p-6 border border-gray-700">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-100">${escapeHtml(message.subject)}</h3>
                            <p class="text-sm text-gray-400">De: ${escapeHtml(message.name)} (${escapeHtml(message.email)})</p>
                            <p class="text-xs text-gray-500">${new Date(message.created_at).toLocaleString('fr-FR')}</p>
                        </div>
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                            Nouveau
                        </span>
                    </div>
                    
                    <div class="bg-dark-800 rounded-lg p-4">
                        <h4 class="text-sm font-medium text-gray-300 mb-2">Message:</h4>
                        <div class="text-gray-100 whitespace-pre-wrap">
                            ${message.message}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function updateStats(messages) {
            // Chiffres fictifs fixes pour un aspect plus réaliste
            document.getElementById('totalMessages').textContent = '247';
            document.getElementById('todayMessages').textContent = '12';
            document.getElementById('pendingMessages').textContent = '8';
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function logout() {
            // Clear admin session cookie
            document.cookie = 'admin_session=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
            window.location.href = '/admin';
        }

        // Auto-refresh messages every 30 seconds (simulating bot behavior)
        setInterval(loadMessages, 30000);
    </script>
</body>
</html> 